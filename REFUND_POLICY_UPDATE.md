# Cáº­p nháº­t ChÃ­nh sÃ¡ch HoÃ n tiá»n KhÃ³a há»c

## ğŸ“‹ Äiá»u kiá»‡n hoÃ n tiá»n má»›i (cáº­p nháº­t)

### âœ… **CÃ¡c Ä‘iá»u kiá»‡n Ä‘Æ°á»£c phÃ©p hoÃ n tiá»n:**

1. **Thá»i gian mua hÃ ng**: Pháº£i mua khÃ³a há»c **dÆ°á»›i 7 ngÃ y** (tÃ­nh tá»« ngÃ y táº¡o Ä‘Æ¡n hÃ ng)

2. **Tiáº¿n Ä‘á»™ há»c táº­p**: **Tiáº¿n Ä‘á»™ há»c pháº£i dÆ°á»›i 20%** (tÃ­nh theo sá»‘ bÃ i há»c Ä‘Ã£ hoÃ n thÃ nh)

3. **Tráº¡ng thÃ¡i Ä‘Æ¡n hÃ ng**: 
   - ÄÆ¡n hÃ ng pháº£i cÃ³ tráº¡ng thÃ¡i `paid` (Ä‘Ã£ thanh toÃ¡n)
   - ChÆ°a Ä‘Æ°á»£c hoÃ n tiá»n trÆ°á»›c Ä‘Ã³ (khÃ´ng cÃ³ `refundedAt` vÃ  status khÃ´ng pháº£i `refunded`)

4. **Quyá»n sá»Ÿ há»¯u**: 
   - Chá»‰ ngÆ°á»i mua khÃ³a há»c má»›i cÃ³ thá»ƒ yÃªu cáº§u hoÃ n tiá»n
   - Pháº£i Ä‘Äƒng nháº­p vÃ  xÃ¡c thá»±c

5. **TÃ­nh há»£p lá»‡ cá»§a khÃ³a há»c**:
   - KhÃ³a há»c pháº£i tá»“n táº¡i trong Ä‘Æ¡n hÃ ng
   - Pháº£i Ä‘Ã£ Ä‘Äƒng kÃ½ há»c khÃ³a há»c Ä‘Ã³

### âŒ **CÃ¡c trÆ°á»ng há»£p KHÃ”NG Ä‘Æ°á»£c hoÃ n tiá»n:**

1. **QuÃ¡ thá»i háº¡n**: Mua khÃ³a há»c trÃªn 7 ngÃ y
2. **Tiáº¿n Ä‘á»™ vÆ°á»£t quÃ¡**: ÄÃ£ hoÃ n thÃ nh trÃªn 20% bÃ i há»c
3. **ÄÃ£ hoÃ n tiá»n**: ÄÆ¡n hÃ ng Ä‘Ã£ Ä‘Æ°á»£c hoÃ n tiá»n trÆ°á»›c Ä‘Ã³
4. **KhÃ´ng tÃ¬m tháº¥y Ä‘Æ¡n hÃ ng**: ÄÆ¡n hÃ ng khÃ´ng tá»“n táº¡i hoáº·c khÃ´ng thuá»™c vá» user
5. **KhÃ´ng chá»©a khÃ³a há»c**: ÄÆ¡n hÃ ng khÃ´ng cÃ³ khÃ³a há»c Ä‘Æ°á»£c yÃªu cáº§u hoÃ n tiá»n

### ğŸ’° **Má»©c hoÃ n tiá»n:**

- **HoÃ n tiá»n 70%** giÃ¡ trá»‹ Ä‘Ã£ tráº£ cho khÃ³a há»c
- Tiá»n Ä‘Æ°á»£c cá»™ng vÃ o **vÃ­ ngÆ°á»i dÃ¹ng** (UserWallet)
- Sá»‘ tiá»n Ä‘Æ°á»£c lÃ m trÃ²n theo Ä‘Æ¡n vá»‹ VND

### ğŸ”„ **Quy trÃ¬nh hoÃ n tiá»n:**

1. **Kiá»ƒm tra Ä‘iá»u kiá»‡n** â†’ XÃ¡c minh thá»i gian, tiáº¿n Ä‘á»™, tráº¡ng thÃ¡i, quyá»n sá»Ÿ há»¯u
2. **TÃ­nh toÃ¡n sá»‘ tiá»n** â†’ 70% Ã— giÃ¡ khÃ³a há»c Ã— sá»‘ lÆ°á»£ng
3. **Cá»™ng tiá»n vÃ o vÃ­** â†’ Cáº­p nháº­t balance vÃ  lá»‹ch sá»­ giao dá»‹ch
4. **Cáº­p nháº­t tráº¡ng thÃ¡i** â†’ ÄÃ¡nh dáº¥u Ä‘Æ¡n hÃ ng Ä‘Ã£ hoÃ n tiá»n
5. **XÃ³a enrollment** â†’ Há»§y Ä‘Äƒng kÃ½ khÃ³a há»c cá»§a user

### ğŸ¯ **Giao diá»‡n ngÆ°á»i dÃ¹ng:**

- NÃºt "HoÃ n tiá»n 70%" hiá»ƒn thá»‹ thÃ´ng tin tiáº¿n Ä‘á»™ vÃ  thá»i gian cÃ²n láº¡i
- ThÃ´ng bÃ¡o rÃµ rÃ ng khi khÃ´ng Ä‘á»§ Ä‘iá»u kiá»‡n hoÃ n tiá»n
- Hiá»ƒn thá»‹ pháº§n trÄƒm tiáº¿n Ä‘á»™ hiá»‡n táº¡i
- ThÃ´ng bÃ¡o thÃ nh cÃ´ng/tháº¥t báº¡i chi tiáº¿t

### ğŸ“Š **CÃ¡ch tÃ­nh tiáº¿n Ä‘á»™:**

- Tiáº¿n Ä‘á»™ = (Sá»‘ bÃ i há»c Ä‘Ã£ hoÃ n thÃ nh / Tá»•ng sá»‘ bÃ i há»c) Ã— 100%
- BÃ i há»c Ä‘Æ°á»£c tÃ­nh lÃ  "hoÃ n thÃ nh" khi:
  - ÄÃ£ xem Ä‘á»§ 90% video
  - ÄÃ£ vÆ°á»£t qua quiz (náº¿u cÃ³)
  - TrÆ°á»ng `completed = true` trong enrollment progress

### ğŸ”§ **Cáº­p nháº­t ká»¹ thuáº­t:**

1. **Backend**: ThÃªm logic kiá»ƒm tra tiáº¿n Ä‘á»™ trong `refundOrder`
2. **API má»›i**: `GET /api/orders/check-refund/:courseId` Ä‘á»ƒ kiá»ƒm tra Ä‘iá»u kiá»‡n
3. **Frontend**: Cáº­p nháº­t UI hiá»ƒn thá»‹ thÃ´ng tin chi tiáº¿t
4. **Service**: ThÃªm method `checkRefundEligibility` trong OrderService

### ğŸ“ **LÆ°u Ã½:**

- Äiá»u kiá»‡n 20% tiáº¿n Ä‘á»™ giÃºp báº£o vá»‡ quyá»n lá»£i cá»§a giáº£ng viÃªn
- NgÆ°á»i dÃ¹ng váº«n cÃ³ 7 ngÃ y Ä‘á»ƒ thá»­ nghiá»‡m khÃ³a há»c
- ThÃ´ng tin tiáº¿n Ä‘á»™ Ä‘Æ°á»£c tÃ­nh toÃ¡n real-time
- Há»‡ thá»‘ng tá»± Ä‘á»™ng cáº­p nháº­t tráº¡ng thÃ¡i hoÃ n tiá»n 